# 为什么做这个

看到论坛上有人组网失败(TailScale, WireGuard), 这是因为 WireGuard 在国内水土不服, 没有公网 IP, 打洞支持是强需求, 而 TailScale 的服务器在国外连接成功率低

于是就想我可不可以做一个呢, 但是因为国内对 VPN 之类的管控很严, 要求的资质很严格, 所以需要去中心化, 让网友可以自行搭建中转点

还有就是国内交流软件有审查, 使用 p2p 点对点的交流就没问题了, 但因为国内点对点不方便所以需要一个组网工具解决这个问题

# 第一性原理的反问

- **软件是给谁用的**  
  想和其他人安全交流的用户

# 一些抉择

- **为什么选 WebRTC 方案, 而不是和 TailScale 一样的纯 STUN 端口发现**  
  因为我当时也在写爬虫项目, 想将网页直接集成到应用中, 不用去写 chrome rdp, 而是直接使用 http proxy + 辅助脚本请求接口更加简便泛用
- **为什么取名`井`**  
  因为`井`这个词相当好, 完美符合 VPN 隐藏在表面下的交流, 并且还有一个展示窗口, 符合我的愿景, well net 也是一个连接其他人的网络
- **为什么使用 NAT, 明明使用 IPv6 的话地址已经足够了**  
  这是因为去中心化的话难免会出现地址冲突, 采用 NAT 就可以完全避免这个问题.

## NAT 路由

砍掉是否使用 NAT 的选项, 全部使用 NAT, 只允许节点各拥有一个 IPv4 和 IPv6 地址

### IPv6 路由段 - `fdd9:f800::/24`

不可变动, 如果路由有冲突, 请修改你的本地路由解决冲突.

自动分配的 IPv6 地址段是 `fdd9:f800::/32`

保留的 IPv6 地址段: `fdd9:f8f0::/32` ~ `fdd9:f8ff::/32`

目前所使用的各个地址段:

- `fdd9:f800::/32` 自动分配所使用的地址段
- `fdd9:f8ff::/32` 固定 IP 段
- `fdd9:f8f4::/32` 当 IPv4 已设置时, 分配一个 4in6 NAT 地址, 以便 IPv6 NAT 访问

#### 为什么不允许变动 IPv6 路由段?

因为我要允许 **固定 IP** 的 IPv6 地址(通过 MAC 地址生成 EUI-64), 以便通过域名访问节点, 有了域名就有 https, 那就能像普通的互联网一样使用了

**固定 IP** 的 IPv6 地址段是 `fdd9:f8ff::/32`

假设根据 MAC 生成的地址是 `fdd9:f8ff::a2ce:c8ff:fe1a:2b3c`, 那么中间那部分都是属于这个 MAC 地址的, 你都可以使用, 如:

- `fdd9:f8ff:0:0:a2ce:c8ff:fe1a:2b3c` 默认的
- `fdd9:f8ff:0:1:a2ce:c8ff:fe1a:2b3c` 往地址里+1
- `fdd9:f8ff:ffff:ffff:a2ce:c8ff:fe1a:2b3c` 最后一个可用的, 总计有 `2**32` 大约 42.9 万个 IP 可用

当然这些都是依靠 MAC 地址不重复达成的, 只有购买的 MAC 地址才不会重复, 所以不要用虚拟 MAC

后续可能会购买一批 MAC 地址用以分配唯一的 **固定 IP**, 目前钱包空空, 得去打工才有钱买

### IPv4 路由段 - `192.168.211.0/20`

因为可能会和现有的私网路由冲突, 所以 IPv4 路由段是可以修改的

分配 IPv4 地址时会额外分配一个 IPv6 地址, 如 `192.168.211.1/32` 会额外分配一个 `fdd9:f8f4::192.168.211.1/128` IPv6 地址, 这有助于 IPv6 NAT 地址的访问

`192.168.211.0/20` 有 4096 个 IP, 感觉足够个人使用了

# 合法性?

合法是合法, 但保护基本是没有的. 因为公安机关是可以要求配合, 所以建议自行编译开源版使用

### 宪法

> 第四十条　中华人民共和国公民的通信自由和通信秘密受法律的保护。
> 除因国家安全或者追查刑事犯罪的需要，由公安机关或者检察机关依照法律规定的程序对通信进行检查外，任何组织或者个人不得以任何理由侵犯公民的通信自由和通信秘密。

### 刑事诉讼法

如果公安机关要求微信之类的通信工具配合的话微信是需要配合的, 并且可以保密. 所以节点服务提供商需要配合提供你的 IP 地址, 网络不是法外之地.

`第二编　立案、侦查和提起公诉` -> `第八节　技术侦查措施` -> `第一百五十二条`

> 公安机关依法采取技术侦查措施，有关单位和个人应当配合，并对有关情况予以保密。
